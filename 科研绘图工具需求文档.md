## 1. 概述

**目标**： 开发一款基于 Python 的科研绘图工具，实现数据一键导入、自动美化与手动细节调整，帮助科研人员快速生成高质量可发表的图表。

**操作系统**： Arch Linux（内核版本 >=5.10，支持 pacman 包管理）。

## 2. 背景与动机

- 科研绘图常见痛点：API 调用繁琐、样式统一性差；对美观性要求高但手动调整耗时。
- 结合成熟绘图库（Matplotlib、Seaborn、Plotly），封装一套易用工具，降低绘图门槛。

## 3. 范围

- **包含**：
  - 多种数据格式导入
  - 常见科研图类型生成
  - 预设美化主题
  - 交互式手动调整
  - 多格式高分辨率导出
- **不包含**：
  - 专用领域算法（如基因组可视化）
  - 大规模并行计算优化

## 4. 系统架构

1. **命令行/脚本入口**：提供 CLI 接口，支持参数化调用
2. **核心模块**：
   - 数据导入
   - 绘图引擎
   - 自动美化
   - 手动调整（GUI/API）
   - 配置管理
3. **辅助模块**：导出、日志、错误处理、扩展插件

## 5. 功能需求

### 5.1 数据导入模块

- **文件支持**：CSV、Excel（xlsx/xls）、JSON、TXT、HDF5
- **数据库**：SQLite、MySQL、PostgreSQL（可选）
- **接口**：
  - `import_data(path, format, **kwargs)`
  - 支持批量导入多个数据集
  - 自动类型推断与缺失值处理

### 5.2 绘图功能模块

- **图表类型**：
  - 折线图、散点图、柱状图、箱线图、热图、等高线图、3D 曲面图
- **底层库**：Matplotlib + Seaborn；可选 Plotly 以支持互动
- **API 示例**：
  ```python
  fig = plot.line(data, x='time', y='value')
  ```

### 5.3 一键美化模块

- **预设主题**：`default`, `ggplot`, `seaborn-darkgrid`, `pub-nature`, `pub-ieee`
- **自动优化**：色彩搭配、字体（支持宋体/英文字体切换）、线型/标记、网格样式、图例位置、坐标刻度格式化
- **配置**：支持 YAML/JSON 主题文件，用户可定义并加载自定义主题

### 5.4 手动调整模块

- **GUI 模式**：
  - 基于 PyQt5 或 Tkinter
  - 滑块（linewidth、fontsize、透明度）、颜色选择器、图例/轴标题编辑框
  - 实时预览与撤销/重做
- **脚本/交互模式**：
  - 通过函数调用或 Jupyter Notebook 中使用 IPyWidgets
  - 支持动态更新

### 5.5 导出模块

- **格式**：PNG、PDF、SVG、EPS
- **选项**：分辨率 (dpi)、画幅尺寸、文件命名支持模板（如 `{figure_name}_{timestamp}`）
- **批量导出**：可一次性输出多张图表

## 6. 非功能需求

- **性能**：
  - 单张常规模型图（<100k 点）生成时间 < 2s
  - 支持百万级数据分批绘制、下采样
- **可用性**：
  - 简洁直观的 CLI 提示与帮助文档
  - GUI 操作无卡顿，滑块调节延迟 <200ms
- **可扩展性**：插件机制，用户可自定义图表类型或主题
- **可维护性**：模块化设计，代码覆盖率 ≥80%
- **兼容性**：Python 3.8+，支持虚拟环境及 pip/conda 安装

## 7. 技术与环境要求

- **语言**：Python 3.8+
- **依赖库**：
  - 数据处理：numpy, pandas, scipy
  - 绘图：matplotlib, seaborn, plotly（可选）
  - GUI：PySide6 (Qt6) + QML
  - 交互：ipython, jupyter, ipywidgets
- **系统环境**：
  - Arch Linux，pacman 管理
  - 建议使用虚拟环境：`python -m venv` 或 `pipenv`

## 8. 安装与部署

1. **系统依赖**：
   ```bash
   sudo pacman -Syu python python-pip python-virtualenv qt5-base
   ```
2. **创建虚拟环境**：
   ```bash
   python -m venv venv
   source venv/bin/activate
   ```
3. **安装 Python 包**：
   ```bash
   pip install -r requirements.txt
   ```
4. **启动方式**：
   - CLI：`plottool --config config.yaml`
   - GUI：`plottool-gui`

## 9. 用户场景与用例

| 用例 ID | 描述                                 |
| ----- | ---------------------------------- |
| UC1   | 导入 CSV，生成折线图，一键美化并导出 PDF           |
| UC2   | 在 GUI 中加载数据，调整字体大小、线宽、颜色，保存 SVG    |
| UC3   | 在 Jupyter Notebook 中交互式更改图例位置与刻度格式 |

## 10. 风险与兼容性

- **风险**：
  - 大数据量绘图卡顿
  - 不同系统依赖版本不一致引发兼容问题
- **缓解措施**：
  - 支持数据下采样与多线程渲染
  - 提供 Docker 镜像保证环境一致

---

*文档版本：1.0   日期：2025-07-27*

